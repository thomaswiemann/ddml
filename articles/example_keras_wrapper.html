<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ddml">
<title>Constructing a new ML Wrapper â€¢ ddml</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Constructing a new ML Wrapper">
<meta property="og:description" content="ddml">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Copyright (c) 2000-2023 etracker GmbH. All rights reserved. --><!-- This material may not be reproduced, displayed, modified or distributed --><!-- without the express prior written permission of the copyright holder. --><!-- etracker tracklet 5.0 --><script type="text/javascript">
// var et_pagename = "";
// var et_areas = "";
// var et_tval = 0;
// var et_tsale = 0;
// var et_tonr = "";
// var et_basket = "";
</script><script id="_etLoader" type="text/javascript" charset="UTF-8" data-block-cookies="true" data-secure-code="6ggnmg" src="//code.etracker.com/code/e.js" async></script><!-- etracker tracklet 5.0 end -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ddml</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ddml.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example_401k.html">Example on the Effect of 401k Participation</a>
    <a class="dropdown-item" href="../articles/example_BLP1995.html">Example using Berry, Levinson, Pakes (1995)</a>
    <a class="dropdown-item" href="../articles/example_keras_wrapper.html">Constructing a new ML Wrapper</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/thomaswiemann/ddml/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Constructing a new ML Wrapper</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/thomaswiemann/ddml/blob/HEAD/vignettes/articles/example_keras_wrapper.Rmd" class="external-link"><code>vignettes/articles/example_keras_wrapper.Rmd</code></a></small>
      <div class="d-none name"><code>example_keras_wrapper.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Load <code>keras</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thomaswiemann/ddml" class="external-link">ddml</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tensorflow.rstudio.com/" class="external-link">keras</a></span><span class="op">)</span></span></code></pre></div>
<p>Construct keras wrapper. The prediction methods for keras already
outputs a numerical vector. It is thus not necessary to also construct a
wrapper for the prediction method.</p>
<p>The first part of the wrapper constructs a neural network
architecture. Below is a simple example using the relu activation
function and potential ell_1 regularization in the hidden or output
layers. This part of the wrapper should be adjusted for more complicated
architectures.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdl_keras</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>,</span>
<span>                      <span class="va">units</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">nhidden</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">lambda1</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">lambda2</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                      <span class="va">optimizer_fun</span> <span class="op">=</span> <span class="st">"rmsprop"</span>,</span>
<span>                      <span class="va">loss</span> <span class="op">=</span> <span class="st">"mse"</span>,</span>
<span>                      <span class="va">epochs</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                      <span class="va">batch_size</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      <span class="va">validation_split</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                      <span class="va">callbacks</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                      <span class="va">steps_per_epoch</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                      <span class="va">metrics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mae"</span><span class="op">)</span>,</span>
<span>                      <span class="va">verbose</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># ============================================================================</span></span>
<span>  <span class="co"># ADJUST FOR DIFFERENT ARCHITECTURES =========================================</span></span>
<span></span>
<span>  <span class="co"># Construct neural network architecture</span></span>
<span>  <span class="va">nnet</span> <span class="op">&lt;-</span> <span class="fu">keras_model_sequential</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nhidden</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">nnet</span> <span class="op">&lt;-</span> <span class="va">nnet</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layer_dense</span><span class="op">(</span>units <span class="op">=</span> <span class="va">units</span>, use_bias <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                  activation <span class="op">=</span> <span class="st">"relu"</span>,</span>
<span>                  kernel_regularizer <span class="op">=</span> <span class="fu">regularizer_l1</span><span class="op">(</span>l <span class="op">=</span> <span class="va">lambda1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="co">#FOR</span></span>
<span>  <span class="va">nnet</span> <span class="op">&lt;-</span> <span class="va">nnet</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">layer_dense</span><span class="op">(</span>units <span class="op">=</span> <span class="fl">1</span>, use_bias <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                kernel_regularizer <span class="op">=</span> <span class="fu">regularizer_l1</span><span class="op">(</span>l <span class="op">=</span> <span class="va">lambda2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ============================================================================</span></span>
<span>  <span class="co"># ADJUST FOR DIFFERENT ARCHITECTURES =========================================</span></span>
<span></span>
<span>  <span class="co"># Compile model</span></span>
<span>  <span class="va">nnet</span> <span class="op">%&gt;%</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu">compile</span><span class="op">(</span>optimizer <span class="op">=</span> <span class="va">optimizer_fun</span>,</span>
<span>                           loss <span class="op">=</span> <span class="va">loss</span>,</span>
<span>                           metrics <span class="op">=</span> <span class="va">metrics</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Fit neural net</span></span>
<span>  <span class="va">nnet</span> <span class="op">%&gt;%</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu">fit</span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>,</span>
<span>                       epochs <span class="op">=</span> <span class="va">epochs</span>,</span>
<span>                       batch_size <span class="op">=</span> <span class="va">batch_size</span>,</span>
<span>                       validation_split <span class="op">=</span> <span class="va">validation_split</span>,</span>
<span>                       callbacks <span class="op">=</span> <span class="va">callbacks</span>,</span>
<span>                       steps_per_epoch <span class="op">=</span> <span class="va">steps_per_epoch</span>,</span>
<span>                       verbose <span class="op">=</span> <span class="va">verbose</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Amend class</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">nnet</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mdl_keras"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">nnet</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Return fit</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">nnet</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="co">#MDL_KERAS</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predict.mdl_keras</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obj</span>, <span class="va">newdata</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Check for new data</span></span>
<span>  <span class="co">#if(is.null(newdata)) newdata &lt;- obj$X</span></span>
<span>  <span class="co"># Predict data and output as matrix</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="co"># Not a pretty solution...</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">obj</span>, <span class="va">newdata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="co">#PREDICT.MDL_KERAS</span></span></code></pre></div>
<p>Letâ€™s test this on a simple empirical example. I consider the
BLP_1995 data and, for simplicity, estimate a partially linear model
(rather than a partially linear iv model).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">BLP_1995</span><span class="op">$</span><span class="va">share</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">BLP_1995</span><span class="op">$</span><span class="va">outshr</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="va">BLP_1995</span><span class="op">$</span><span class="va">price</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">BLP_1995</span><span class="op">$</span><span class="va">space</span>, <span class="va">BLP_1995</span><span class="op">$</span><span class="va">hpwt</span><span class="op">)</span></span></code></pre></div>
<p>Next, we need to specify the particular neural network learner we
want to use. In addition to the architecture, itâ€™s important to properly
tune the optimization algorithm. callback_list below helps with
specifying learning rate adjustments and defines the early stopping
rule.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">callbacks_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">callback_early_stopping</span><span class="op">(</span>monitor <span class="op">=</span> <span class="st">"val_loss"</span>,</span>
<span>                                                            patience <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                                                            restore_best_weights <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">callback_reduce_lr_on_plateau</span><span class="op">(</span>monitor <span class="op">=</span> <span class="st">"val_loss"</span>,</span>
<span>                                                                  factor <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">10</span>,</span>
<span>                                                                  patience <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                                                                  verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">callback_learning_rate_scheduler</span><span class="op">(</span></span>
<span>                                      <span class="kw">function</span><span class="op">(</span><span class="va">epoch</span>, <span class="va">learning_rate</span><span class="op">)</span><span class="op">{</span></span>
<span>                                        <span class="kw">if</span><span class="op">(</span><span class="va">epoch</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">learning_rate</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span>                                        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">learning_rate</span><span class="op">)</span></span>
<span>                                      <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">learners</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>what <span class="op">=</span> <span class="va">mdl_keras</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fl">10</span>, nhidden <span class="op">=</span> <span class="fl">1</span>, lambda1 <span class="op">=</span> <span class="fl">0</span>, lambda2 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  epochs <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                                  verbose <span class="op">=</span> <span class="cn">F</span>,</span>
<span>                                  validation_split <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                  callbacks <span class="op">=</span> <span class="va">callbacks_list</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can now run the ddml estimator. Note that because we have set
verbose to TRUE in the above list of arguments, live training output is
automatically plotted. This is very helpful for assessing whether the
defined training parameters are sensible. Since it substantially slows
down the training process, however, verbose should be set to FALSE
whenever youâ€™re not planning to actively monitor the output.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>plm_fit <span class="ot">&lt;-</span> <span class="fu">ddml_plm</span>(y, D, X, <span class="at">learners =</span> learners)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; DDML estimation in progress. </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>E[Y<span class="sc">|</span>X]<span class="sc">:</span>  sample fold <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>E[Y<span class="sc">|</span>X]<span class="sc">:</span>  sample fold <span class="dv">2</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">--</span> Done<span class="sc">!</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>E[D<span class="sc">|</span>X]<span class="sc">:</span>  sample fold <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>E[D<span class="sc">|</span>X]<span class="sc">:</span>  sample fold <span class="dv">2</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">--</span> Done<span class="sc">!</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; DDML estimation completed.</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>plm_fit<span class="sc">$</span>coef</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      D_r </span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1.632659</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">fun =</span> mdl_keras,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">args =</span> <span class="fu">list</span>(<span class="at">units =</span> <span class="dv">10</span>, <span class="at">nhidden =</span> <span class="dv">1</span>, <span class="at">lambda1 =</span> <span class="dv">0</span>, <span class="at">lambda2 =</span> <span class="dv">0</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">verbose =</span> F,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">validation_split =</span> <span class="fl">0.1</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">callbacks =</span> callbacks_list)),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">list</span>(<span class="at">fun =</span> mdl_keras,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">args =</span> <span class="fu">list</span>(<span class="at">units =</span> <span class="dv">5</span>, <span class="at">nhidden =</span> <span class="dv">2</span>, <span class="at">lambda1 =</span> <span class="dv">0</span>, <span class="at">lambda2 =</span> <span class="dv">0</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">verbose =</span> F,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">validation_split =</span> <span class="fl">0.1</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">callbacks =</span> callbacks_list)))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>plm_fit <span class="ot">&lt;-</span> <span class="fu">ddml_plm</span>(y, D, X, <span class="at">learners =</span> learners, <span class="at">shortstack =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; DDML estimation in progress. </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>E[Y<span class="sc">|</span>X]<span class="sc">:</span> sample fold <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>E[Y<span class="sc">|</span>X]<span class="sc">:</span> sample fold <span class="dv">2</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">--</span> Done<span class="sc">!</span> </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>E[D<span class="sc">|</span>X]<span class="sc">:</span> sample fold <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>E[D<span class="sc">|</span>X]<span class="sc">:</span> sample fold <span class="dv">2</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">--</span> Done<span class="sc">!</span> </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; DDML estimation completed.</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>plm_fit<span class="sc">$</span>coef</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       D_r </span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.8318073</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Achim Ahrens, Christian B Hansen, Mark E Schaffer, Thomas Wiemann.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
