<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ddml">
<title>Example using Berry, Levinson, Pakes (1995) • ddml</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example using Berry, Levinson, Pakes (1995)">
<meta property="og:description" content="ddml">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Copyright (c) 2000-2023 etracker GmbH. All rights reserved. --><!-- This material may not be reproduced, displayed, modified or distributed --><!-- without the express prior written permission of the copyright holder. --><!-- etracker tracklet 5.0 --><script type="text/javascript">
// var et_pagename = "";
// var et_areas = "";
// var et_tval = 0;
// var et_tsale = 0;
// var et_tonr = "";
// var et_basket = "";
</script><script id="_etLoader" type="text/javascript" charset="UTF-8" data-block-cookies="true" data-secure-code="6ggnmg" src="//code.etracker.com/code/e.js" async></script><!-- etracker tracklet 5.0 end -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ddml</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ddml.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/stacking.html">Computational Benefits of Short-Stacking</a>
    <a class="dropdown-item" href="../articles/keras_wrapper.html">Constructing a User-Provided Base Learner</a>
    <a class="dropdown-item" href="../articles/sparse.html">Estimation with Sparse Matrices</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/thomaswiemann/ddml/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example using Berry, Levinson, Pakes (1995)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/thomaswiemann/ddml/blob/HEAD/vignettes/articles/example_BLP95.Rmd" class="external-link"><code>vignettes/articles/example_BLP95.Rmd</code></a></small>
      <div class="d-none name"><code>example_BLP95.Rmd</code></div>
    </div>

    
    
<p>Work in progress. Check back soon!</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We revisits the empirical example of Chernozhukov, Hansen, and
Spindler (2015) (CHS2015, hereafter), which extends the instruments of
Berry, Levinson, and Pakes (1995) (BLP1995, hereafter) and applies an
instrument selection procedure based on the Lasso. We consider the same
instrument extension and apply a selection of ensemble procedures that
combines conventional linear estimators with computational alternatives
including Lasso-based approaches and random forests.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thomaswiemann/ddml" class="external-link">ddml</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-construction">Data construction<a class="anchor" aria-label="anchor" href="#data-construction"></a>
</h2>
<p>Automobile market data from Berry, Levinsohn, Pakes (1995) as
retrived from the reproduction excercise in Chernozhukov, Hansen, and
Spindler (2015). <a href="https://www.aeaweb.org/articles?id=10.1257/aer.p20151022" class="external-link">link</a></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BLP95</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"data/BLP95.rds"</span><span class="op">)</span></span></code></pre></div>
<p>The BLP1995 data is included as an exemplary dataset with the ddml
package under the name <code>BLP95</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">share</span><span class="op">)</span> <span class="op">-</span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">outshr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">price</span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">BLP95</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hpwt"</span>, <span class="st">"air"</span>, <span class="st">"mpd"</span>, <span class="st">"space"</span>, <span class="st">"price"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"share"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">D</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"price"</span></span></code></pre></div>
<p>We now construct the BLP1995 instruments, which are sums of product
characteristics (excluding price and other potentially endogenous
variables) of other products offered by the firm as well as over
competing firms. The exact instrument specification here follows the
approach of CHS2015.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_</span> <span class="op">&lt;-</span> <span class="va">x1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>; <span class="va">ncol_X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_</span><span class="op">)</span> <span class="co"># exclude price</span></span>
<span><span class="va">sum_other</span> <span class="op">&lt;-</span> <span class="va">sum_rival</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nobs</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nobs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">other_ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">firmid</span> <span class="op">==</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">firmid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">cdid</span> <span class="op">==</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">cdid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">id</span> <span class="op">!=</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">rival_ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">firmid</span> <span class="op">!=</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">firmid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">cdid</span> <span class="op">==</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">cdid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sum_other</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">X_</span><span class="op">[</span><span class="va">other_ind</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sum_rival</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">X_</span><span class="op">[</span><span class="va">rival_ind</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="co">#FOR</span></span>
<span><span class="va">Z_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sum_other</span>, <span class="va">sum_rival</span><span class="op">)</span>; <span class="va">ncol_Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z_</span><span class="op">)</span></span></code></pre></div>
<p>In addition, we may be interested in extending the list of
instruments. The below constructs the additional instruments considered
in CHS2015.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tu</span> <span class="op">=</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">trend</span><span class="op">/</span><span class="fl">19</span>;</span>
<span><span class="va">mpdu</span> <span class="op">=</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">mpd</span><span class="op">/</span><span class="fl">7</span>;</span>
<span><span class="va">spaceu</span> <span class="op">=</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">space</span><span class="op">/</span><span class="fl">2</span>;</span>
<span><span class="va">XL_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">BLP95</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hpwt"</span>, <span class="st">"air"</span><span class="op">)</span><span class="op">]</span>, <span class="va">mpdu</span>, <span class="va">spaceu</span>, <span class="va">tu</span>,</span>
<span>                       <span class="va">BLP95</span><span class="op">$</span><span class="va">hpwt</span><span class="op">^</span><span class="fl">2</span>, <span class="va">BLP95</span><span class="op">$</span><span class="va">hpwt</span><span class="op">^</span><span class="fl">3</span>, <span class="va">mpdu</span><span class="op">^</span><span class="fl">2</span>, <span class="va">mpdu</span><span class="op">^</span><span class="fl">3</span>,</span>
<span>                       <span class="va">spaceu</span><span class="op">^</span><span class="fl">2</span>, <span class="va">spaceu</span><span class="op">^</span><span class="fl">3</span>, <span class="va">tu</span><span class="op">^</span><span class="fl">2</span>, <span class="va">tu</span><span class="op">^</span><span class="fl">3</span>, <span class="va">BLP95</span><span class="op">$</span><span class="va">hpwt</span> <span class="op">*</span></span>
<span>                         <span class="va">BLP95</span><span class="op">$</span><span class="va">air</span>,  <span class="va">mpdu</span> <span class="op">*</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">air</span>, <span class="va">spaceu</span> <span class="op">*</span></span>
<span>                         <span class="va">BLP95</span><span class="op">$</span><span class="va">air</span>, <span class="va">tu</span> <span class="op">*</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">air</span>, <span class="va">BLP95</span><span class="op">$</span><span class="va">hpwt</span> <span class="op">*</span></span>
<span>                         <span class="va">mpdu</span>, <span class="va">BLP95</span><span class="op">$</span><span class="va">hpwt</span> <span class="op">*</span> <span class="va">spaceu</span>, <span class="va">BLP95</span><span class="op">$</span><span class="va">hpwt</span> <span class="op">*</span> <span class="va">tu</span>,</span>
<span>                       <span class="va">mpdu</span> <span class="op">*</span> <span class="va">spaceu</span>,  <span class="va">mpdu</span> <span class="op">*</span> <span class="va">tu</span>, <span class="va">spaceu</span> <span class="op">*</span> <span class="va">tu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ncol_XL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">XL_</span><span class="op">)</span></span>
<span><span class="va">sum_otherL</span> <span class="op">&lt;-</span> <span class="va">sum_rivalL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nobs</span>, <span class="fl">24</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nobs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">other_ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">firmid</span> <span class="op">==</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">firmid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">cdid</span> <span class="op">==</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">cdid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">id</span> <span class="op">!=</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">rival_ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">firmid</span> <span class="op">!=</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">firmid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">(</span><span class="va">BLP95</span><span class="op">$</span><span class="va">cdid</span> <span class="op">==</span> <span class="va">BLP95</span><span class="op">$</span><span class="va">cdid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sum_otherL</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">XL_</span><span class="op">[</span><span class="va">other_ind</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">sum_rivalL</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">XL_</span><span class="op">[</span><span class="va">rival_ind</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="co">#FOR</span></span>
<span><span class="va">ZL_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sum_otherL</span>,<span class="va">sum_rivalL</span><span class="op">)</span>; <span class="va">ncol_ZL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ZL_</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimating-the-flexible-partially-linear-iv-model-with-cv-lasso">Estimating the Flexible Partially Linear IV Model with CV-Lasso<a class="anchor" aria-label="anchor" href="#estimating-the-flexible-partially-linear-iv-model-with-cv-lasso"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Base learner</span></span>
<span><span class="va">learner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>what <span class="op">=</span> <span class="va">mdl_glmnet</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># DDML IV. We consider cross-residiualization across 10 sample folds here.</span></span>
<span><span class="va">lasso_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddml_fpliv.html">ddml_fpliv</a></span><span class="op">(</span><span class="va">y</span>, D <span class="op">=</span> <span class="va">D</span>,</span>
<span>                           Z <span class="op">=</span> <span class="va">ZL_</span>, X <span class="op">=</span> <span class="va">XL_</span>,</span>
<span>                           learners <span class="op">=</span> <span class="va">learner</span>,</span>
<span>                           sample_folds <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                           silent <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">lasso_fit</span><span class="op">$</span><span class="va">coef</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimating-the-flexible-partially-linear-iv-model-with-stacking">Estimating the Flexible Partially Linear IV Model with Stacking<a class="anchor" aria-label="anchor" href="#estimating-the-flexible-partially-linear-iv-model-with-stacking"></a>
</h2>
<p>#’ A more ambitious approach may consider a variety of computational
models for #’ the estimation of the first and second stage. Here, we
consider a #’ combination of linear models, including unpenalized, Lasso
and Ridge #’ regression, random forests, generalized random forests #’
(Athey et al., 2019), and boosted trees, using either the inital set of
#’ instruments as in BLP1995 or the extended set as in CHS2015. As
before, #’ we specify seperate first and second stage model sets
(although this is #’ not strictly necessary).</p>
<p>#’ Combine the data. It’s convinient to specify sets of indices for
easier #’ column selection in the model specification. When using random
forests, #’ it’s important that variables have columnames.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X_</span>, <span class="va">XL_</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X_c</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_c</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Z_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Z_</span>, <span class="va">ZL_</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Z_c</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z_c</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">set_X</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_</span><span class="op">)</span>; <span class="va">set_XL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X_c</span><span class="op">)</span><span class="op">)</span>, <span class="va">set_X</span><span class="op">)</span></span>
<span><span class="va">set_Z</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z_</span><span class="op">)</span>; <span class="va">set_ZL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z_c</span><span class="op">)</span><span class="op">)</span>, <span class="va">set_Z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimating-the-flexible-partially-linear-iv-model-with-short-stacking">Estimating the Flexible Partially Linear IV Model with
Short-Stacking<a class="anchor" aria-label="anchor" href="#estimating-the-flexible-partially-linear-iv-model-with-short-stacking"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Base learners</span></span>
<span><span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">ols</span>,</span>
<span>                       assign_X <span class="op">=</span> <span class="va">set_X</span>,</span>
<span>                       assign_Z <span class="op">=</span> <span class="va">set_Z</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_glmnet</span>,</span>
<span>                       args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       assign_X <span class="op">=</span> <span class="va">set_XL</span>,</span>
<span>                       assign_Z <span class="op">=</span> <span class="va">set_ZL</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_glmnet</span>,</span>
<span>                       args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                       assign_X <span class="op">=</span> <span class="va">set_XL</span>,</span>
<span>                       assign_Z <span class="op">=</span> <span class="va">set_ZL</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># DDML IV. We consider cross-residiualization across 10 sample folds here.</span></span>
<span><span class="va">stacking_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddml_fpliv.html">ddml_fpliv</a></span><span class="op">(</span><span class="va">y</span>, D <span class="op">=</span> <span class="va">D</span>,</span>
<span>                           Z <span class="op">=</span> <span class="va">Z_c</span>, X <span class="op">=</span> <span class="va">X_c</span>,</span>
<span>                           learners <span class="op">=</span> <span class="va">learners</span>,</span>
<span>                           ensemble_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ols"</span>, <span class="st">"nnls"</span>, <span class="st">"nnls1"</span>,</span>
<span>                                             <span class="st">"singlebest"</span>, <span class="st">"average"</span><span class="op">)</span>,</span>
<span>                           shortstack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                           sample_folds <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                           silent <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">stacking_fit</span><span class="op">$</span><span class="va">coef</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Achim Ahrens, Christian B Hansen, Mark E Schaffer, Thomas Wiemann.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
