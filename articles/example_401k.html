<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example on the Effect of 401k Participation • ddml</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example on the Effect of 401k Participation">
<!-- Copyright (c) 2000-2023 etracker GmbH. All rights reserved. --><!-- This material may not be reproduced, displayed, modified or distributed --><!-- without the express prior written permission of the copyright holder. --><!-- etracker tracklet 5.0 --><script type="text/javascript">
// var et_pagename = "";
// var et_areas = "";
// var et_tval = 0;
// var et_tsale = 0;
// var et_tonr = "";
// var et_basket = "";
</script><script id="_etLoader" type="text/javascript" charset="UTF-8" data-block-cookies="true" data-secure-code="6ggnmg" src="//code.etracker.com/code/e.js" async></script><!-- etracker tracklet 5.0 end --><!-- math rendering issues  https://github.com/r-lib/pkgdown/issues/2704 --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ddml</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ddml.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/stacking.html">Computational Benefits of Short-Stacking</a></li>
    <li><a class="dropdown-item" href="../articles/new_ml_wrapper.html">Constructing a User-Provided Base Learner</a></li>
    <li><a class="dropdown-item" href="../articles/sparse.html">Estimation with Sparse Matrices</a></li>
    <li><a class="dropdown-item" href="../articles/did.html">Diff-in-Diff with Double/Debiased Machine Learning</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thomaswiemann/ddml/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example on the Effect of 401k Participation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/thomaswiemann/ddml/blob/master/vignettes/articles/example_401k.Rmd" class="external-link"><code>vignettes/articles/example_401k.Rmd</code></a></small>
      <div class="d-none name"><code>example_401k.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article illustrates key features of <code>ddml</code> by
estimating the effect of 401k participation on retirement savings. In
particular, the example showcases the following features:</p>
<ul>
<li>Estimation using a single machine learner</li>
<li>Estimation using multiple machine learners via short-stacking</li>
<li>Estimation using multiple machine learners <em>and</em> different
sets of control variables</li>
<li>Estimation using different sets of machine learners for continuous
and binary outcome and treatment variables</li>
</ul>
<p>After introduction of the data, the article illustrates each above
feature in turn.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thomaswiemann/ddml" class="external-link">ddml</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2410072</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-construction">Data construction<a class="anchor" aria-label="anchor" href="#data-construction"></a>
</h2>
<p>The 401K data considered here is from the Survey of Income and
Program Participation (SIPP) from the year 1991. We use the data taken
from the application in <a href="https://academic.oup.com/ectj/article/21/1/C1/5056401s%7D" class="external-link">Chernozhukov
et al. (2018)</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SIPP91</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"data/SIPP91.rds"</span><span class="op">)</span></span></code></pre></div>
<p>The endogenous variable of interest is an indicator equal to 1 if the
person participates in a 401k. We are interested in estimating its
effect on net financial assets and control for various individual
characteristics (e.g., age and income).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">SIPP91</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">SIPP91</span><span class="op">$</span><span class="va">net_tfa</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">SIPP91</span><span class="op">$</span><span class="va">p401</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">SIPP91</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"inc"</span>, <span class="st">"educ"</span>, <span class="st">"fsize"</span>,</span>
<span>                      <span class="st">"marr"</span>, <span class="st">"twoearn"</span>, <span class="st">"db"</span>, <span class="st">"pira"</span>, <span class="st">"hown"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimation-using-a-single-machine-learner">Estimation using a Single Machine Learner<a class="anchor" aria-label="anchor" href="#estimation-using-a-single-machine-learner"></a>
</h2>
<p>The simplest double/debiased machine learning estimator for the
causal effect of 401k participation on financial assets considers a
single machine learner to (nonparametrically) control for individual
characteristics. We consider gradient boosting in the code snippet below
(see <code><a href="../reference/ddml_plm.html">?ddml_plm</a></code> and <code><a href="../reference/mdl_xgboost.html">?mdl_xgboost</a></code> for
details).</p>
<p>A comparison with a simple multiple linear regression estimate
indicates a difference in the point estimates of about one standard
deviation, suggesting that there are at least some non-linearities
present in the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PLM with gradient boosting</span></span>
<span><span class="va">xgboost_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddml_plm.html">ddml_plm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, D <span class="op">=</span> <span class="va">D</span>, X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                        learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>what <span class="op">=</span> <span class="va">mdl_xgboost</span>,</span>
<span>                                        args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds <span class="op">=</span> <span class="fl">300</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        sample_folds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                        silent <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">xgboost_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; PLM estimation results: </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; , , single base learner</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept)     -224        626  -0.357 7.21e-01</span></span>
<span><span class="co">#&gt; D_r            13916       1604   8.678 4.03e-18</span></span>
<span></span>
<span><span class="co"># Comparison to multiple linear regression</span></span>
<span><span class="va">lm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">D</span> <span class="op">+</span> <span class="va">X</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Estimate   Std. Error      t value     Pr(&gt;|t|) </span></span>
<span><span class="co">#&gt; 1.160089e+04 1.345117e+03 8.624444e+00 7.428141e-18</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimation-using-multiple-machine-learners">Estimation using Multiple Machine Learners<a class="anchor" aria-label="anchor" href="#estimation-using-multiple-machine-learners"></a>
</h2>
<p>Instead of considering just a single – and possibly ill-tuned –
machine learner to control for covariates, it is often helpful to
combine a diverse set of learners. The code snippet below considers a
set of six learners (see <code><a href="../reference/ols.html">?ols</a></code>, <code><a href="../reference/mdl_glmnet.html">?mdl_glmnet</a></code>,
<code><a href="../reference/mdl_ranger.html">?mdl_ranger</a></code> for details). The learners are combined to
minimize out-of-sample mean square prediction error in the reduced form
of the outcome and the endogenous variable on the controls,
respectively. To reduce the computational burden, we consider
short-stacking (see also <code>vignette("stacking")</code>).</p>
<p>The estimate is nearly identical to the estimate using just gradient
boosting.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify set of learners</span></span>
<span><span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">ols</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_glmnet</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_ranger</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">250</span>,</span>
<span>                                  max.depth <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_ranger</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">250</span>,</span>
<span>                                  max.depth <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_xgboost</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_xgboost</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds <span class="op">=</span> <span class="fl">300</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PLM with short-stacking</span></span>
<span><span class="va">stacking_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddml_plm.html">ddml_plm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, D <span class="op">=</span> <span class="va">D</span>, X <span class="op">=</span> <span class="va">X</span>,</span>
<span>                         learners <span class="op">=</span> <span class="va">learners</span>,</span>
<span>                         ensemble_type <span class="op">=</span> <span class="st">"nnls"</span>,</span>
<span>                         sample_folds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                         shortstack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                         silent <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stacking_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; PLM estimation results: </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; , , nnls</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept)    -1627        538   -3.03 2.48e-03</span></span>
<span><span class="co">#&gt; D_r            13636       1526    8.94 4.04e-19</span></span></code></pre></div>
<p>To better understand which machine learners contribute to the final
estimate, we can take a look at the assigned stacking weights. Each row
corresponds to a base-learner (in chronological order) while the columns
indicate the corresponding reduced form. The weights show that the two
random forest estimators contribute the most in both reduced forms,
followed by the lasso estimator. Neither gradient boosting nor linear
regression are assigned substantial weight.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">stacking_fit</span><span class="op">$</span><span class="va">weights</span>, <span class="va">round</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;         y_X   D1_X</span></span>
<span><span class="co">#&gt; [1,] 0.0048 0.0197</span></span>
<span><span class="co">#&gt; [2,] 0.2113 0.2817</span></span>
<span><span class="co">#&gt; [3,] 0.2973 0.3400</span></span>
<span><span class="co">#&gt; [4,] 0.5770 0.3504</span></span>
<span><span class="co">#&gt; [5,] 0.0000 0.0000</span></span>
<span><span class="co">#&gt; [6,] 0.0000 0.0238</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimation-with-different-sets-of-control-variables">Estimation with Different Sets of Control Variables<a class="anchor" aria-label="anchor" href="#estimation-with-different-sets-of-control-variables"></a>
</h2>
<p>The large weight assigned to random forests suggests that
non-linearities and potential interactions may be important. While
random forests and gradient boosting adaptively constructs such
non-linearities, linear methods such as the lasso need to pre-specify
these variables to capture more complex patterns in the data. A better
set of machine learners to consider would thus consider different sets
of variables for different machine learners:</p>
<ul>
<li>linear regression and lasso with an extended set of control
variables</li>
<li>random forests and gradient boosting with the original set of
control variables</li>
</ul>
<p>We extend the control variables using a simple third-order polynomial
expansion of the non-binary control variables (with interactions). These
are combine with the original control variables. In addition, we
construct to sets of indices that reference the two sets of
controls.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"inc"</span>, <span class="st">"educ"</span>, <span class="st">"fsize"</span><span class="op">)</span><span class="op">]</span>, degree <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">X_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">X_series</span><span class="op">)</span></span>
<span><span class="va">X_baseline</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="co"># baseline variables and indicators</span></span>
<span><span class="va">X_extended</span> <span class="op">&lt;-</span> <span class="fl">5</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X_c</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="co"># indicators &amp; series expansion</span></span></code></pre></div>
<p><code>ddml</code> supports passing different sets of control
variables to different base learners via the <code>assign_X</code>
argument, which includes the column-indices corresponding to the desired
variables of the control matrix.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify base learners with different sets of controls</span></span>
<span><span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">ols</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">ols</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_extended</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_glmnet</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_extended</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_ranger</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">250</span>,</span>
<span>                                  max.depth <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_ranger</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">250</span>,</span>
<span>                                  max.depth <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_xgboost</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_xgboost</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PLM with short-stacking</span></span>
<span><span class="va">stacking_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddml_plm.html">ddml_plm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, D <span class="op">=</span> <span class="va">D</span>, X <span class="op">=</span> <span class="va">X_c</span>,</span>
<span>                         learners <span class="op">=</span> <span class="va">learners</span>,</span>
<span>                         ensemble_type <span class="op">=</span> <span class="st">"nnls"</span>,</span>
<span>                         sample_folds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                         shortstack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                         silent <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stacking_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; PLM estimation results: </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; , , nnls</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept)     -512        533  -0.961 3.37e-01</span></span>
<span><span class="co">#&gt; D_r            14363       1500   9.575 1.02e-21</span></span></code></pre></div>
<p>To assess whether the additional effort in expanding the control
variables had an effect on the composition of the reduced form
estimates, we can again inspect the stacking weights. Indeed, the new
base learner that combines lasso with the polynomial expansion of the
controls is assigned the largest weight, followed by the random forest
estimators.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">stacking_fit</span><span class="op">$</span><span class="va">weights</span>, <span class="va">round</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;         y_X   D1_X</span></span>
<span><span class="co">#&gt; [1,] 0.0176 0.0000</span></span>
<span><span class="co">#&gt; [2,] 0.0000 0.1219</span></span>
<span><span class="co">#&gt; [3,] 0.7368 0.4056</span></span>
<span><span class="co">#&gt; [4,] 0.0000 0.1693</span></span>
<span><span class="co">#&gt; [5,] 0.2702 0.2613</span></span>
<span><span class="co">#&gt; [6,] 0.0022 0.0522</span></span>
<span><span class="co">#&gt; [7,] 0.0000 0.0048</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimation-with-continious-and-binary-outcome-and-treatment-variables">Estimation with Continious and Binary Outcome and Treatment
Variables<a class="anchor" aria-label="anchor" href="#estimation-with-continious-and-binary-outcome-and-treatment-variables"></a>
</h2>
<p>Thus far, we have considered the same set of base learners for the
reduced form of the outcome on controls and the reduced form of the
endogenous variable on the controls. In contrast to net financial assets
which is (approximately) continuous, participating in a 401k is a binary
indicator. It may thus sensible to consider reduced form estimators with
support on the unit-interval for the latter reduced form. For example,
we could consider logistic regression instead of linear regression.</p>
<p>Equipped with the included <code>mdl_glm</code> wrapper for
generalized linear models (see also <code><a href="../reference/mdl_glm.html">?mdl_glm</a></code>), we now
specify a second set of base-learners for the reduced form of the binary
endogenous variable of interest on the controls. As in the previous
section, we consider different sets of control variables as well. When
estimating the double/debiased machine learning estimator, we pass the
second set of base learners via the <code>learners_DX</code>
argument.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify an additional set of learners for the reduced form E[D|X]</span></span>
<span><span class="va">learners_DX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_glm</span>,</span>
<span>                         args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_glm</span>,</span>
<span>                         args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_extended</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_glmnet</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_extended</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_ranger</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">250</span>,</span>
<span>                                  max.depth <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_ranger</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num.trees <span class="op">=</span> <span class="fl">250</span>,</span>
<span>                                  max.depth <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_xgboost</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">mdl_xgboost</span>,</span>
<span>                      args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nrounds <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>,</span>
<span>                      assign_X <span class="op">=</span> <span class="va">X_baseline</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PLM with short-stacking and different sets of learners</span></span>
<span><span class="va">stacking_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddml_plm.html">ddml_plm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, D <span class="op">=</span> <span class="va">D</span>, X <span class="op">=</span> <span class="va">X_c</span>,</span>
<span>                         learners <span class="op">=</span> <span class="va">learners</span>,</span>
<span>                         learners_DX <span class="op">=</span> <span class="va">learners_DX</span>,</span>
<span>                         ensemble_type <span class="op">=</span> <span class="st">"nnls"</span>,</span>
<span>                         sample_folds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                         shortstack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                         silent <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stacking_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; PLM estimation results: </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; , , nnls</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept)     -487        535   -0.91 3.63e-01</span></span>
<span><span class="co">#&gt; D_r            14097       1484    9.50 2.07e-21</span></span></code></pre></div>
<p>The weights associated with the new base learners are now slightly
larger:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">stacking_fit</span><span class="op">$</span><span class="va">weights</span>, <span class="va">round</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;         y_X   D1_X</span></span>
<span><span class="co">#&gt; [1,] 0.0132 0.0627</span></span>
<span><span class="co">#&gt; [2,] 0.0000 0.2663</span></span>
<span><span class="co">#&gt; [3,] 0.7411 0.0086</span></span>
<span><span class="co">#&gt; [4,] 0.0000 0.4221</span></span>
<span><span class="co">#&gt; [5,] 0.2690 0.2552</span></span>
<span><span class="co">#&gt; [6,] 0.0000 0.0000</span></span>
<span><span class="co">#&gt; [7,] 0.0000 0.0302</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bonus-instrumental-variable-estimation">Bonus: Instrumental Variable Estimation<a class="anchor" aria-label="anchor" href="#bonus-instrumental-variable-estimation"></a>
</h2>
<p>Instead of considering the partially linear regression model, we may
also be interested in an instrumental variable approach. A commonly used
instrument for participation in a 401k is 401k <em>eligibility</em>.</p>
<p>The below code-snippet estimates the partially linear IV model using
the two sets of machine learners introduced in previous sections.
Because the instrument is binary, we use the generalized linear models
to estimate the reduced form of 401k eligibility on the controls.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 401k eligibility as the instrument</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">SIPP91</span><span class="op">$</span><span class="va">e401</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PLIV with short-stacking and different sets of learners</span></span>
<span><span class="va">stacking_IV_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddml_pliv.html">ddml_pliv</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, D <span class="op">=</span> <span class="va">D</span>, Z <span class="op">=</span> <span class="va">Z</span>, X <span class="op">=</span> <span class="va">X_c</span>,</span>
<span>                         learners <span class="op">=</span> <span class="va">learners</span>,</span>
<span>                         learners_DX <span class="op">=</span> <span class="va">learners_DX</span>,</span>
<span>                         learners_ZX <span class="op">=</span> <span class="va">learners_DX</span>,</span>
<span>                         ensemble_type <span class="op">=</span> <span class="st">"nnls"</span>,</span>
<span>                         sample_folds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                         shortstack <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                         silent <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stacking_IV_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; PLIV estimation results: </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; , , nnls</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept)     -776        531   -1.46 1.44e-01</span></span>
<span><span class="co">#&gt; D_r            12987       1872    6.94 3.97e-12</span></span>
<span></span>
<span><span class="co"># Stacking weights associated with each base learner</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">stacking_IV_fit</span><span class="op">$</span><span class="va">weights</span>, <span class="va">round</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;         y_X   D1_X   Z1_X</span></span>
<span><span class="co">#&gt; [1,] 0.0000 0.0647 0.0000</span></span>
<span><span class="co">#&gt; [2,] 0.0000 0.2271 0.2414</span></span>
<span><span class="co">#&gt; [3,] 0.7474 0.0080 0.0157</span></span>
<span><span class="co">#&gt; [4,] 0.0000 0.4030 0.5337</span></span>
<span><span class="co">#&gt; [5,] 0.2953 0.3036 0.2501</span></span>
<span><span class="co">#&gt; [6,] 0.0000 0.0351 0.0000</span></span>
<span><span class="co">#&gt; [7,] 0.0000 0.0000 0.0000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Chernozhukov V, Chetverikov D, Demirer M, Duflo E, Hansen C B, Newey
W, Robins J (2018). “Double/debiased machine learning for treatment and
structural parameters.” The Econometrics Journal, 21(1), C1-C68.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Achim Ahrens, Christian B Hansen, Mark E Schaffer, Thomas Wiemann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
